{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","_http","negociacao","getConnection","then","connection","dao","adiciona","catch","erro","console","log","Error","listaTodos","apagaTodos","listaAtual","obterNegociacoes","negociacoes","filter","some","isEquals","negociacaoExistente","get","map","obj","Date","data","quantidade","valor","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","periodos","reduce","dados","periodo","concat"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\nimport {ConnectionFactory} from './ConnectionFactory';\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\nimport {Negociacao} from '../models/Negociacao';\n\nexport class NegociacaoService {\n\n\tconstructor() {\n\n\t\tthis._http = new HttpService();\n\t}\n\n\tcadastra(negociacao) {\n\n\t\treturn ConnectionFactory\n\t\t\t.getConnection()\n\t\t\t.then((connection) => new NegociacaoDao(connection))\n\t\t\t.then((dao) => dao.adiciona(negociacao))\n\t\t\t.then(() => 'Negociação adicionada com sucesso')\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível adicionar a negociação');\n\t\t\t});\n\t}\n\n\tlista() {\n\n\t\treturn ConnectionFactory\n\t\t\t.getConnection()\n\t\t\t.then((connection) => new NegociacaoDao(connection))\n\t\t\t.then((dao) => dao.listaTodos())\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível listar as negociações');\n\t\t\t});\n\t}\n\n\tlimpa() {\n\n\t\treturn ConnectionFactory\n\t\t\t.getConnection()\n\t\t\t.then((connection) => new NegociacaoDao(connection))\n\t\t\t.then((dao) => dao.apagaTodos())\n\t\t\t.then(() => 'Negociações apagadas com sucesso')\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível apagar as negociações')\n\t\t\t});\n\t}\n\n\timporta(listaAtual) {\n\n\t\treturn this.obterNegociacoes()\n\t\t\t.then((negociacoes) =>\n\t\t\t\tnegociacoes.filter((negociacao) =>\n\t\t\t\t\t!listaAtual.some(negociacaoExistente =>\n\t\t\t\t\t\tnegociacao.isEquals(negociacaoExistente)))\n\t\t\t)\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível buscar as negociações para importar');\n\t\t\t});\n\t}\n\n\tobterNegociacoesDaSemana() {\n\n\t\treturn this._http\n\t\t\t.get('negociacoes/semana')\n\t\t\t.then((negociacoes) => {\n\t\t\t\treturn negociacoes.map((obj) => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\n\t\t\t})\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana');\n\t\t\t});\n\t}\n\n\tobterNegociacoesDaSemanaAnterior() {\n\n\t\treturn this._http\n\t\t\t.get('negociacoes/anterior')\n\t\t\t.then((negociacoes) => {\n\t\t\t\treturn negociacoes.map((obj) => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\n\t\t\t})\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana anterior');\n\t\t\t});\n\t}\n\n\tobterNegociacoesDaSemanaRetrasada() {\n\n\t\treturn this._http\n\t\t\t.get('negociacoes/retrasada')\n\t\t\t.then((negociacoes) => {\n\t\t\t\treturn negociacoes.map((obj) => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\n\t\t\t})\n\t\t\t.catch((erro) => {\n\t\t\t\tconsole.log(erro);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana retrasada');\n\t\t\t});\n\t}\n\n\tobterNegociacoes() {\n\n\t\treturn Promise.all([\n\t\t\tthis.obterNegociacoesDaSemana(),\n\t\t\tthis.obterNegociacoesDaSemanaAnterior(),\n\t\t\tthis.obterNegociacoesDaSemanaRetrasada()\n\t\t])\n\t\t\t.then((periodos) => {\n\t\t\t\tlet negociacoes = periodos\n\t\t\t\t\t.reduce((dados, periodo) => dados.concat(periodo), []);\n\n\t\t\t\treturn negociacoes;\n\t\t\t})\n\t\t\t.catch((erro) => {\n\t\t\t\tthrow new Error(erro)\n\t\t\t});\n\t}\n}"]}